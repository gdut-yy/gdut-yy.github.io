import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as l}from"./app-D75trwlE.js";const e="/doc-gitblogs-hope/assets/sharded-cluster-production-architecture.bakedsvg-bUk90SGi.svg",t={};function h(d,i){return l(),a("div",null,i[0]||(i[0]=[n(`<h1 id="mongodb-环境" tabindex="-1"><a class="header-anchor" href="#mongodb-环境"><span>MongoDB 环境</span></a></h1><h2 id="_1-downloads" tabindex="-1"><a class="header-anchor" href="#_1-downloads"><span>1 Downloads</span></a></h2><p><code>mongodb-linux-x86_64-ubuntu1804-4.0.28.tgz</code>: <a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noopener noreferrer">https://www.mongodb.com/try/download/community</a></p><p>当前最新版本是 <code>5.0.6</code>，但因线上项目多是 <code>4.0.x/4.2.x</code>，所以下载：</p><ul><li>Version: <code>4.0.28</code></li><li>Platform: <code>Ubuntu 18.04</code></li><li>Package: <code>tgz</code></li></ul><h2 id="_2-启动" tabindex="-1"><a class="header-anchor" href="#_2-启动"><span>2 启动</span></a></h2><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 解压</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zxvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mongodb-linux-x86_64-ubuntu1804-4.0.28.tgz</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mongodb-linux-x86_64-ubuntu1804-4.0.28/bin/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./mongod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --bind_ip_all</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-索引-createindex" tabindex="-1"><a class="header-anchor" href="#_3-索引-createindex"><span>3 索引（createIndex）</span></a></h2><p>官方文档: <a href="https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/</a></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看索引</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.collection.getIndexes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建索引</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.collection.createIndex(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> _id:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;hashed&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> },</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> background:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> }</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看进度</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.currentOp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-分区-shardcollection" tabindex="-1"><a class="header-anchor" href="#_4-分区-shardcollection"><span>4 分区（shardCollection）</span></a></h2><figure><img src="`+e+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看分片状况</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sh.status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用分片</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> admin</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.runCommand(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enableSharding:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;db&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> }</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sh.enableSharding(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;db&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 判断是否进行了分片</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.collection.stats</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().sharded</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进行分片</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.runCommand(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shardCollection:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;db.collection&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {id:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> }</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> )</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sh.shardCollection(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;db.collection&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {&quot;id&quot;:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（全文完）</p>`,14)]))}const p=s(t,[["render",h],["__file","index.html.vue"]]),o=JSON.parse('{"path":"/module_sre/sre_mongodb/","title":"MongoDB 环境","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"1 Downloads","slug":"_1-downloads","link":"#_1-downloads","children":[]},{"level":2,"title":"2 启动","slug":"_2-启动","link":"#_2-启动","children":[]},{"level":2,"title":"3 索引（createIndex）","slug":"_3-索引-createindex","link":"#_3-索引-createindex","children":[]},{"level":2,"title":"4 分区（shardCollection）","slug":"_4-分区-shardcollection","link":"#_4-分区-shardcollection","children":[]}],"git":{"createdTime":1702795363000,"updatedTime":1702795363000,"contributors":[{"name":"gdut-yy","username":"gdut-yy","email":"gdut_yy@163.com","commits":1}]},"readingTime":{"minutes":0.51,"words":152},"filePathRelative":"module_sre/sre_mongodb/README.md","localizedDate":"2023年12月17日"}');export{p as comp,o as data};
